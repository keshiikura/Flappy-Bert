<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Flappy Bird</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background: #70c5ce;
        font-family: Arial, sans-serif;
        touch-action: manipulation;
    }

    #gameCanvas {
        display: block;
        margin: 0 auto;
        background: linear-gradient(#70c5ce, #ffffff);
    }

    #score {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        color: #fff;
        font-size: 40px;
        font-weight: bold;
        text-shadow: 2px 2px 5px #000;
    }

    #message {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: yellow;
        font-size: 30px;
        font-weight: bold;
        text-shadow: 2px 2px 5px #000;
        display: none;
        text-align: center;
        padding: 0 20px;
    }
</style>
</head>
<body>

<canvas id="gameCanvas" width="400" height="600"></canvas>
<div id="score">0</div>
<div id="message">Press Space or Tap to Start</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// Make canvas responsive
function resizeCanvas() {
    const scale = Math.min(window.innerWidth / 400, window.innerHeight / 600);
    canvas.style.width = 400 * scale + "px";
    canvas.style.height = 600 * scale + "px";
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// BIRD IMAGE
const birdImg = new Image();
birdImg.src = "lhian.png"; // replace with your PNG URL

// Bird position and size
let birdX = 50;
let birdY = 250;
let birdWidth = 80;
let birdHeight;

// Physics
let gravity = 0.4; // pixels per frame at 60fps
let velocity = 0;
let jump = -7;

// Pipes
let pipes = [];
let pipeWidth = 60;
let pipeGap = 200;
let pipeSpeed = 3; // pixels per frame at 60fps
let minPipeDistance = 320;

// Game state
let score = 0;
let gameOver = false;
let gameStarted = false;

// SOUND EFFECTS
let flapSound = new Audio("https://www.soundjay.com/buttons/sounds/button-16.mp3");
let pointSound = new Audio("https://www.soundjay.com/button/sounds/button-09.mp3");
let hitSound = new Audio("https://www.soundjay.com/button/sounds/button-10.mp3");

// Preload sounds for mobile
function initSounds() {
    [flapSound, pointSound, hitSound].forEach(sound => {
        sound.play().catch(()=>{});
        sound.pause();
        sound.currentTime = 0;
    });
}
document.addEventListener("keydown", initSounds, {once:true});
document.addEventListener("mousedown", initSounds, {once:true});
document.addEventListener("touchstart", initSounds, {once:true});

// Set bird height based on aspect ratio
birdImg.onload = function() {
    const aspectRatio = birdImg.height / birdImg.width;
    birdHeight = birdWidth * aspectRatio;
    showMessage("Press Space or Tap to Start");
};

// Draw the bird
function drawBird() {
    ctx.drawImage(birdImg, birdX, birdY, birdWidth, birdHeight);
}

// Create new pipes
function createPipe() {
    let topHeight = Math.random() * (canvas.height - pipeGap - 50);
    let bottomHeight = canvas.height - topHeight - pipeGap;

    pipes.push({
        x: canvas.width,
        top: topHeight,
        bottom: bottomHeight,
        scored: false
    });
}

// Draw all pipes
function drawPipes() {
    ctx.fillStyle = "green";
    pipes.forEach(p => {
        ctx.fillRect(p.x, 0, pipeWidth, p.top);
        ctx.fillRect(p.x, canvas.height - p.bottom, pipeWidth, p.bottom);
    });
}

// Update pipes (time-based)
function updatePipes(deltaTime) {
    pipes.forEach(p => p.x -= pipeSpeed * deltaTime);

    if (pipes.length > 0 && pipes[0].x + pipeWidth < 0) {
        pipes.shift();
    }

    if (pipes.length === 0 || canvas.width - pipes[pipes.length - 1].x >= minPipeDistance) {
        createPipe();
    }
}

// Detect collisions
function detectCollision() {
    for (let p of pipes) {
        if (
            birdX + birdWidth > p.x &&
            birdX < p.x + pipeWidth &&
            (birdY < p.top || birdY + birdHeight > canvas.height - p.bottom)
        ) {
            return true;
        }
    }
    return birdY + birdHeight > canvas.height || birdY < 0;
}

// Update score
function updateScore() {
    pipes.forEach(p => {
        if (!p.scored && p.x + pipeWidth < birdX) {
            score++;
            p.scored = true;
            document.getElementById("score").innerText = score;
            pointSound.play();
        }
    });
}

// Show/Hide messages
function showMessage(msg) {
    const messageDiv = document.getElementById("message");
    messageDiv.innerText = msg;
    messageDiv.style.display = "block";
}
function hideMessage() {
    document.getElementById("message").style.display = "none";
}

// Reset game
function resetGame() {
    birdY = 250;
    velocity = 0;
    pipes = [];
    score = 0;
    gameOver = false;
    document.getElementById("score").innerText = score;
}

// Time-based game loop
let lastTime = 0;
function gameLoop(timestamp) {
    const deltaTime = (timestamp - lastTime) / 16.67; // 16.67ms â‰ˆ 60fps
    lastTime = timestamp;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (gameStarted && !gameOver) {
        velocity += gravity * deltaTime;
        birdY += velocity * deltaTime;

        drawBird();
        drawPipes();
        updatePipes(deltaTime);
        updateScore();

        if (detectCollision()) {
            gameOver = true;
            hitSound.play();
            showMessage("Game Over! Press Space or Tap to Restart");
        }
    } else {
        drawBird();
        drawPipes();
    }

    requestAnimationFrame(gameLoop);
}
requestAnimationFrame(gameLoop);

// Flap function
function flap() {
    if (!gameStarted) {
        gameStarted = true;
        hideMessage();
        return;
    }

    if (!gameOver) {
        velocity = jump;
        flapSound.play();
    } else {
        resetGame();
        hideMessage();
        gameStarted = false;
        showMessage("Press Space or Tap to Start");
    }
}

// Controls
document.addEventListener("keydown", e => { if (e.code === "Space") flap(); });
document.addEventListener("mousedown", flap);
document.addEventListener("touchstart", e => { e.preventDefault(); flap(); }, {passive: false});
</script>

</body>
</html>
